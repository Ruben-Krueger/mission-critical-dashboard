<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/css/bootstrap.min.css" integrity="sha384-Zug+QiDoJOrZ5t4lssLdxGhVrurbmBWopoEl+M6BdEfwnCJZtKxi1KgxUyJq13dy" crossorigin="anonymous">
    <link rel="stylesheet" href="main.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.6/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js"></script>
    <script src ="https://cdnjs.cloudflare.com/ajax/libs/jquery-footable/3.1.6/footable.editing.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-footable/3.1.6/footable.bootstrap.css"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-footable/3.1.6/footable.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-footable/3.1.6/footable.editing.min.js"></script>
    <script src ="https://cdnjs.cloudflare.com/ajax/libs/jquery-footable/3.1.6/footable.filtering.min.css"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-footable/3.1.6/footable.filtering.min.js"></script>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <title>Vulnerabilities</title>
</head>
<body>
<div class="container">
    <h1>Mission Critical</h1>
    <table id="showcase-example-1" class="table" data-paging="true" data-filtering="true" data-sorting="true" data-editing="true" data-state="true"></table>

    <!-- Editing Modal Markup -->
    <div class="modal fade" id="editor-modal" tabindex="-1" role="dialog" aria-labelledby="editor-title">
        <style scoped>
            /* provides a red astrix to denote required fields - this should be included in common stylesheet */
            .form-group.required .control-label:after {
                content:"*";
                color:red;
                margin-left: 4px;
            }
        </style>
        <div class="modal-dialog" role="document">
            <form class="modal-content form-horizontal" id="editor">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                    <h4 class="modal-title" id="editor-title">Load New Data</h4>
                </div>
                <div class="modal-body">
                    <input type="number" id="id" name="id" class="hidden"/>
                    <div class="form-group required">
                        <label for="firstName" class="col-sm-3 control-label">Vulnerability</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="firstName" name="firstName" placeholder="First Name" required>
                        </div>
                    </div>
                    <div class="form-group required">
                        <label for="lastName" class="col-sm-3 control-label">Risk</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="lastName" name="lastName" placeholder="Last Name" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="jobTitle" class="col-sm-3 control-label">Discovered</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="jobTitle" name="jobTitle" placeholder="Job Title">
                        </div>
                    </div>
                    <div class="form-group required">
                        <label for="startedOn" class="col-sm-3 control-label">Started On</label>
                        <div class="col-sm-9">
                            <input type="date" class="form-control" id="startedOn" name="startedOn" placeholder="Started On" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="dob" class="col-sm-3 control-label">Discovered By</label>
                        <div class="col-sm-9">
                            <input type="date" class="form-control" id="dob" name="dob" placeholder="Date of Birth">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="status" class="col-sm-3 control-label">Status</label>
                        <div class="col-sm-9">
                            <select class="form-control" id="status" name="status">
                                <option value="Active">Active</option>
                                <option value="Disabled">Disabled</option>
                                <option value="Suspended">Suspended</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Save changes</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    jQuery(function($){
        var $modal = $('#editor-modal'),
            $editor = $('#editor'),
            $editorTitle = $('#editor-title'),
            ft = FooTable.init('#showcase-example-1', {
                columns: $.get("columns.json"),
                rows: $.get("rows.json"),
                editing: {
                    addRow: function(){
                        $modal.removeData('row');
                        $editor[0].reset();
                        $editorTitle.text('Add a new row');
                        $modal.modal('show');
                    },
                    editRow: function(row){
                        var values = row.val();
                        $editor.find('#id').val(values.id);
                        $editor.find('#firstName').val(values.firstName);
                        $editor.find('#lastName').val(values.lastName);
                        $editor.find('#jobTitle').val(values.jobTitle);
                        $editor.find('#status').val(values.status);
                        $editor.find('#startedOn').val(values.started.format('YYYY-MM-DD'));
                        $editor.find('#dob').val(values.dob.format('YYYY-MM-DD'));
                        $modal.data('row', row);
                        $editorTitle.text('Edit row #' + values.id);
                        $modal.modal('show');
                    },
                    deleteRow: function(row){
                        if (confirm('Are you sure you want to delete the row?')){
                            row.delete();
                        }
                    }
                }
            }),
            uid = 10001;

        $editor.on('submit', function(e){
            if (this.checkValidity && !this.checkValidity()) return;
            e.preventDefault();
            var row = $modal.data('row'),
                values = {
                    id: $editor.find('#id').val(),
                    firstName: $editor.find('#firstName').val(),
                    lastName: $editor.find('#lastName').val(),
                    jobTitle: $editor.find('#jobTitle').val(),
                    started: moment($editor.find('#startedOn').val(), 'YYYY-MM-DD'),
                    dob: moment($editor.find('#dob').val(), 'YYYY-MM-DD'),
                    status: $editor.find('#status option:selected').val()
                };

            if (row instanceof FooTable.Row){
                row.val(values);
            } else {
                values.id = uid++;
                ft.rows.add(values);
            }
            $modal.modal('hide');
        });
    });
</script>
</body>
</html>
